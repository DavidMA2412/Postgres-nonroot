apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: tagimagetest
spec:
  params:
  - name: projectname
  - name: image
  workspaces:
  - name: appsource

  steps:
  - name: build-image
    image: quay.io/buildah/stable:v1.17.0
    workingDir: "$(workspaces.appsource.path)/"
    script: |
      #!/usr/bin/env sh
      set -e
      echo projectname: $(params.projectname)
      echo image: $(params.image)
      #source $(workspaces.appsource.path)/revision.txt
      echo REVISION: $REVISION
      REVISION=2

      buildah pull --tls-verify=false docker://ubuntu
      buildah tag docker://ubuntu docker://image-registry.openshift-image-registry.svc:5000/app-mod-argocd-pipelines/ubuntu:$REVISION
      buildah push --tls-verify=false docker://image-registry.openshift-image-registry.svc:5000/app-mod-argocd-pipelines/ubuntu:$REVISION

      echo niklas4
      buildah tag docker://ubuntu docker://image-registry.openshift-image-registry.svc:5000/app-mod-argocd-dev/ubuntu:$REVISION
      buildah push --tls-verify=false docker://image-registry.openshift-image-registry.svc:5000/app-mod-argocd-dev/ubuntu:$REVISION


      
    volumeMounts:
    - name: varlibcontainers
      mountPath: /var/lib/containers
    securityContext:
      privileged: true

  volumes:
  - name: varlibcontainers
    emptyDir: {}
---